import{o as n,h as m,F as D,i as F,j as h,t as g,l as _,w as P,q as C,c as R,k as E,p as S,E as G,f as y,s as f,n as H,g as J,u as M,v as p,x as Q,y as W}from"./vendor.Bd1iBrwI.js";import{_ as U}from"./index.C-P8Qv0o.js";const j={class:"replies"},X={class:"reply-meta"},Y={key:0,class:"pagination"},q=U({__name:"ReplyList",props:{replies:Array,total:Number,currentPage:Number,repliesPerPage:Number,currentUser:String},emits:["page-change","reply-to","delete-reply"],setup:v=>(k,e)=>{const i=S,u=G;return n(),m("div",j,[(n(!0),m(D,null,F(v.replies,a=>(n(),m("div",{class:"reply-item",key:a.id},[h("span",null,g(a.author)+" 回复 "+g(a.to)+"："+g(a.content),1),h("div",X,[h("span",null,g(a.time),1),_(i,{link:"",class:"reply-button",onClick:w=>k.$emit("reply-to",a.author)},{default:P(()=>e[1]||(e[1]=[C(" 回复 ")])),_:2},1032,["onClick"]),a.author===v.currentUser?(n(),R(i,{key:0,link:"",class:"delete-button",onClick:w=>k.$emit("delete-reply",a)},{default:P(()=>e[2]||(e[2]=[C(" 删除 ")])),_:2},1032,["onClick"])):E("",!0)])]))),128)),v.total>v.repliesPerPage?(n(),m("div",Y,[_(u,{layout:"prev, pager, next","page-size":v.repliesPerPage,total:v.total,"current-page":v.currentPage,onCurrentChange:e[0]||(e[0]=a=>k.$emit("page-change",a)),size:"large","hide-on-single-page":!0,"prev-text":"上一页","next-text":"下一页"},null,8,["page-size","total","current-page"])])):E("",!0)])}},[["__scopeId","data-v-46252e2b"]]),K={class:"reply-box"},Z=U({__name:"ReplyBox",props:{placeholder:String},emits:["send-reply"],setup(v,{emit:k}){const e=k,i=y(""),u=y(!1),a=()=>{if(i.value.trim()){u.value=!0;try{e("send-reply",i.value.trim()),i.value=""}catch{f.error("发送回复失败")}finally{u.value=!1}}else f.warning("请输入回复内容")};return(w,x)=>{const A=H,N=S;return n(),m("div",K,[_(A,{modelValue:i.value,"onUpdate:modelValue":x[0]||(x[0]=T=>i.value=T),placeholder:v.placeholder,type:"textarea",maxlength:"200","show-word-limit":""},null,8,["modelValue","placeholder"]),_(N,{type:"primary",onClick:a,loading:u.value,style:{height:"100%"}},{default:P(()=>x[1]||(x[1]=[C(" 发送 ")])),_:1},8,["loading"])])}}},[["__scopeId","data-v-e3f65d73"]]);let I=[{id:1,author:"用户A",content:"这个产品真的很好用，推荐给大家！",time:"2024-09-25 18:00",replies:[{id:1,author:"用户B",to:"用户A",content:"确实不错，我也在用。",time:"2024-09-25 18:05:22"},{id:2,author:"用户C",to:"用户B",content:"请问具体有什么优势呢？",time:"2024-09-25 18:10:45"},{id:3,author:"用户D",to:"用户C",content:"我觉得使用起来非常流畅，功能也很全面。",time:"2024-09-25 18:15:30"},{id:4,author:"用户E",to:"用户A",content:"谢谢推荐，我打算试试看。",time:"2024-09-25 18:20:10"},{id:5,author:"用户F",to:"用户E",content:"一起交流使用心得吧！",time:"2024-09-25 18:25:55"},{id:6,author:"用户G",to:"用户F",content:"好主意，我也想了解更多。",time:"2024-09-25 18:30:40"},{id:7,author:"用户H",to:"用户G",content:"这个产品的售后服务也很好。",time:"2024-09-25 18:35:25"},{id:8,author:"用户I",to:"用户H",content:"是的，上次有问题客服很快就解决了。",time:"2024-09-25 18:40:15"},{id:9,author:"用户J",to:"用户I",content:"看来值得入手，谢谢大家的分享。",time:"2024-09-25 18:45:05"},{id:10,author:"用户K",to:"用户J",content:"不客气，有问题可以一起讨论。",time:"2024-09-25 18:50:50"},{id:11,author:"用户L",to:"用户A",content:"请问在哪里可以买到？",time:"2024-09-25 18:55:35"}],isExpanded:!1},{id:2,author:"用户M",content:"有谁知道这款产品的最新活动吗？",time:"2024-09-25 19:00",replies:[{id:1,author:"用户N",to:"用户M",content:"官方商城有优惠，赶紧去看看吧。",time:"2024-09-25 19:05:22"},{id:2,author:"用户O",to:"用户N",content:"谢谢提醒，我刚下单了。",time:"2024-09-25 19:10:45"},{id:3,author:"用户P",to:"用户O",content:"优惠力度挺大的，不容错过。",time:"2024-09-25 19:15:30"}],isExpanded:!1},{id:3,author:"用户Q",content:"请问这款产品适合新手使用吗？",time:"2024-09-25 19:20",replies:[{id:1,author:"用户R",to:"用户Q",content:"非常适合，操作界面很友好。",time:"2024-09-25 19:25:10"},{id:2,author:"用户S",to:"用户R",content:"赞同，上手很快。",time:"2024-09-25 19:30:55"}],isExpanded:!1},{id:4,author:"用户T",content:"有没有人遇到安装问题？",time:"2024-09-25 19:40",replies:[{id:1,author:"用户U",to:"用户T",content:"可以参考官方教程，很详细。",time:"2024-09-25 19:45:22"},{id:2,author:"用户V",to:"用户U",content:"如果还有问题，可以联系售后。",time:"2024-09-25 19:50:45"}],isExpanded:!1},{id:5,author:"用户W",content:"产品的质量如何？",time:"2024-09-25 20:00",replies:[{id:1,author:"用户X",to:"用户W",content:"质量不错，用了半年没有问题。",time:"2024-09-25 20:05:30"},{id:2,author:"用户Y",to:"用户X",content:"同感，性价比很高。",time:"2024-09-25 20:10:15"},{id:3,author:"用户Z",to:"用户Y",content:"打算推荐给朋友。",time:"2024-09-25 20:15:05"}],isExpanded:!1}];const ee={class:"chat-area"},te={class:"avatar"},ae={class:"message"},le={class:"message-content"},ie={class:"content"},se={class:"message-conOption"},ne={key:0,class:"reply-list"},oe={key:0,class:"loading"},re={class:"message-actions"},ue={key:0},$="当前用户",ce={__name:"index",setup(v){const k=y([]),e=y(null),i=y(!1),u=y(null),a=y(!1),w=y(1),x=y([]),A=J(()=>u.value?`回复 @${u.value}:`:e.value?`回复 ${e.value.author}:`:"请输入回复内容"),N=async()=>{try{k.value=await new Promise(l=>{setTimeout(()=>{l(I)},500)})}catch{f.error("加载消息列表失败")}},T=async l=>{a.value=!0;try{await new Promise(c=>setTimeout(c,500));const r=await(o=l.id,new Promise((c,t)=>{setTimeout(()=>{const d=I.find(s=>s.id===o);d?c(d):t(new Error("消息不存在"))},500)}));l.replies=r.replies,b(l)}catch{f.error("加载回复列表失败")}finally{a.value=!1}var o},b=l=>{const o=8*(w.value-1),r=o+8;x.value=l.replies.slice(o,r)},L=l=>{w.value=l,b(e.value)},V=l=>{i.value=!0,u.value=l},z=async l=>{var o;if(e.value)try{const r={id:Date.now(),author:$,to:u.value||e.value.author,content:l,time:new Date().toLocaleString()},c=await(o=e.value.id,new Promise(t=>{setTimeout(()=>{const d=I.find(s=>s.id===o);t(d?{success:!0}:{success:!1,message:"消息不存在，无法回复"})},500)}));if(!c.success)throw new Error(c.message||"发送回复失败");e.value.replies.unshift(r),e.value.isExpanded?b(e.value):(e.value.isExpanded=!0,await T(e.value)),f.success("回复发送成功")}catch(r){f.error(r.message)}finally{i.value=!1,u.value=null}else f.error("未选择消息")},B=async l=>{a.value=!0;try{const c=await(o=e.value.id,r=l.id,new Promise(t=>{setTimeout(()=>{const d=I.find(s=>s.id===o);if(d){const s=d.replies.findIndex(O=>O.id===r);t(s!==-1?{success:!0}:{success:!1,message:"回复不存在，无法删除"})}else t({success:!1,message:"消息不存在，无法删除回复"})},500)}));if(!c.success)throw new Error(c.message||"删除回复失败");{const t=e.value.replies.findIndex(d=>d.id===l.id);t!==-1&&(e.value.replies.splice(t,1),b(e.value)),f.success("回复已删除")}}catch(c){f.error(c.message)}finally{a.value=!1}var o,r};return M(()=>{N()}),(l,o)=>{const r=S,c=Q;return n(),m("div",ee,[(n(!0),m(D,null,F(p(k),t=>(n(),m("div",{class:"message-item",key:t.id},[h("div",te,g(t.author),1),h("div",ae,[h("div",le,[h("div",ie,g(t.content),1),h("div",se,[h("span",null,g(t.time),1),_(r,{link:"",onClick:d=>(s=>{i.value&&e.value.id===s.id?(i.value=!1,u.value=null):(i.value=!0,e.value=s,u.value=null)})(t)},{default:P(()=>[C(g(p(i)&&p(e).id===t.id?"取消回复":"回复"),1)]),_:2},1032,["onClick"])])]),t.isExpanded?(n(),m("div",ne,[p(a)&&p(e).id===t.id?(n(),m("div",oe,[_(c,null,{default:P(()=>[_(p(W))]),_:1}),o[0]||(o[0]=C(" 加载中... "))])):(n(),R(q,{key:1,replies:p(x),total:t.replies.length,"current-page":p(w),"replies-per-page":8,"current-user":$,onPageChange:L,onReplyTo:V,onDeleteReply:B},null,8,["replies","total","current-page"]))])):E("",!0),h("div",re,[t.replies.length>0?(n(),m("span",ue," 共 "+g(t.replies.length)+" 条回复， ",1)):E("",!0),t.replies.length>0?(n(),R(r,{key:1,link:"",onClick:d=>(async s=>{s.isExpanded=!s.isExpanded,w.value=1,e.value=s,s.isExpanded&&await T(s)})(t)},{default:P(()=>[C(g(t.isExpanded?"收起":"点击查看"),1)]),_:2},1032,["onClick"])):E("",!0)]),p(i)&&p(e).id===t.id?(n(),R(Z,{key:1,placeholder:p(A),onSendReply:z},null,8,["placeholder"])):E("",!0)])]))),128))])}}},me=U(ce,[["__scopeId","data-v-e76fc857"]]);export{me as default};
